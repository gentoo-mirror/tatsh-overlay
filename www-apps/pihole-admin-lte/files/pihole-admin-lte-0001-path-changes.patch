From bb4b2291237379aa8a49757e67d8da1492cd2a31 Mon Sep 17 00:00:00 2001
From: Andrew Udvare <audvare@gmail.com>
Date: Thu, 13 Jan 2022 12:45:41 -0500
Subject: [PATCH 1/4] Path changes

---
 api_db.php                             |  2 +-
 dns_records.php                        |  4 ++--
 scripts/pi-hole/js/queryads.js         |  2 +-
 scripts/pi-hole/php/database.php       |  4 ++--
 scripts/pi-hole/php/func.php           |  4 ++--
 scripts/pi-hole/php/password.php       |  2 +-
 scripts/pi-hole/php/savesettings.php   |  4 ++--
 scripts/pi-hole/php/teleporter.php     | 10 +++++-----
 scripts/pi-hole/php/update_checker.php |  6 +++---
 9 files changed, 19 insertions(+), 19 deletions(-)

diff --git a/api_db.php b/api_db.php
index 15f58047..c393859b 100644
--- a/api_db.php
+++ b/api_db.php
@@ -317,7 +317,7 @@ if (isset($_GET['getQueriesCount']) && $auth)
 
 if (isset($_GET['getDBfilesize']) && $auth)
 {
-	$filesize = filesize("/etc/pihole/pihole-FTL.db");
+	$filesize = filesize("/var/lib/pihole/pihole-FTL.db");
 	$result = array('filesize' => $filesize);
 	$data = array_merge($data, $result);
 }
diff --git a/dns_records.php b/dns_records.php
index dcf9cf25..2c0b81c8 100644
--- a/dns_records.php
+++ b/dns_records.php
@@ -44,9 +44,9 @@ require "scripts/pi-hole/php/header.php";
               <p>The order of locally defined DNS records is: </p>
               <ol>
                   <li>The device's host name and <code>pi.hole</code></li>
-                  <li>Configured in a config file in <code>/etc/dnsmasq.d/</code></li>
+                  <li>Configured in a config file in <code>/etc/pihole/dnsmasq.d/</code></li>
                   <li>Read from <code>/etc/hosts</code></li>
-                  <li>Read from the "Local (custom) DNS" list (stored in <code>/etc/pihole/custom.list</code>)</li>
+                  <li>Read from the "Local (custom) DNS" list (stored in <code>/var/lib/pihole/custom.list</code>)</li>
               </ol>
               <p>Only the first record will trigger an address-to-name association.</p>
                 <button type="button" id="btnAdd" class="btn btn-primary pull-right">Add</button>
diff --git a/scripts/pi-hole/js/queryads.js b/scripts/pi-hole/js/queryads.js
index cb8625ac..1177d1e7 100644
--- a/scripts/pi-hole/js/queryads.js
+++ b/scripts/pi-hole/js/queryads.js
@@ -11,7 +11,7 @@ function quietfilter(ta, data) {
   var lines = data.split("\n");
   for (var i = 0; i < lines.length; i++) {
     if (lines[i].indexOf("results") !== -1 && lines[i].indexOf("0 results") === -1) {
-      var shortstring = lines[i].replace("::: /etc/pihole/", "");
+      var shortstring = lines[i].replace("::: /var/lib/pihole/", "");
       // Remove "(x results)"
       shortstring = shortstring.replace(/\(.*/, "");
       ta.append(shortstring + "\n");
diff --git a/scripts/pi-hole/php/database.php b/scripts/pi-hole/php/database.php
index ee9cff69..dd03e346 100644
--- a/scripts/pi-hole/php/database.php
+++ b/scripts/pi-hole/php/database.php
@@ -16,7 +16,7 @@ function getGravityDBFilename()
 	}
 	else
 	{
-		return "/etc/pihole/gravity.db";
+		return "/var/lib/pihole/gravity.db";
 	}
 }
 
@@ -30,7 +30,7 @@ function getQueriesDBFilename()
 	}
 	else
 	{
-		return "/etc/pihole/pihole-FTL.db";
+		return "/var/lib/pihole/pihole-FTL.db";
 	}
 }
 
diff --git a/scripts/pi-hole/php/func.php b/scripts/pi-hole/php/func.php
index bede54eb..e3f57f8a 100644
--- a/scripts/pi-hole/php/func.php
+++ b/scripts/pi-hole/php/func.php
@@ -152,7 +152,7 @@ function pihole_execute($argument_string) {
 }
 
 // Custom DNS
-$customDNSFile = "/etc/pihole/custom.list";
+$customDNSFile = "/var/lib/pihole/custom.list";
 
 function echoCustomDNSEntries()
 {
@@ -300,7 +300,7 @@ function deleteAllCustomDNSEntries($reload="")
 }
 
 // CNAME
-$customCNAMEFile = "/etc/dnsmasq.d/05-pihole-custom-cname.conf";
+$customCNAMEFile = "/etc/pihole/dnsmasq.d/05-pihole-custom-cname.conf";
 
 function echoCustomCNAMEEntries()
 {
diff --git a/scripts/pi-hole/php/password.php b/scripts/pi-hole/php/password.php
index 038d4bbb..b702ee17 100644
--- a/scripts/pi-hole/php/password.php
+++ b/scripts/pi-hole/php/password.php
@@ -16,7 +16,7 @@
     session_start();
 
     // Read setupVars.conf file
-    $setupVars = parse_ini_file("/etc/pihole/setupVars.conf");
+    $setupVars = parse_ini_file("/var/lib/pihole/setupVars.conf");
     // Try to read password hash from setupVars.conf
     if(isset($setupVars['WEBPASSWORD']))
     {
diff --git a/scripts/pi-hole/php/savesettings.php b/scripts/pi-hole/php/savesettings.php
index b1ab18d2..a9aa7149 100644
--- a/scripts/pi-hole/php/savesettings.php
+++ b/scripts/pi-hole/php/savesettings.php
@@ -35,7 +35,7 @@ function formatMAC($mac_addr)
 }
 
 $dhcp_static_leases = array();
-function readStaticLeasesFile($origin_file="/etc/dnsmasq.d/04-pihole-static-dhcp.conf")
+function readStaticLeasesFile($origin_file="/etc/pihole/dnsmasq.d/04-pihole-static-dhcp.conf")
 {
 	global $dhcp_static_leases;
 	$dhcp_static_leases = array();
@@ -99,7 +99,7 @@ function readDNSserversList()
 {
 	// Reset list
 	$list = [];
-	$handle = @fopen("/etc/pihole/dns-servers.conf", "r");
+	$handle = @fopen("/var/lib/pihole/dns-servers.conf", "r");
 	if ($handle)
 	{
 		while (($line = fgets($handle)) !== false)
diff --git a/scripts/pi-hole/php/teleporter.php b/scripts/pi-hole/php/teleporter.php
index 84abf502..7888f87f 100644
--- a/scripts/pi-hole/php/teleporter.php
+++ b/scripts/pi-hole/php/teleporter.php
@@ -495,7 +495,7 @@ if(isset($_POST["action"]))
 			if(isset($_POST["staticdhcpleases"]) && $file->getFilename() === "04-pihole-static-dhcp.conf")
 			{
 				if($flushtables) {
-					$local_file = @fopen("/etc/dnsmasq.d/04-pihole-static-dhcp.conf", "r+");
+					$local_file = @fopen("/etc/pihole/dnsmasq.d/04-pihole-static-dhcp.conf", "r+");
 					if ($local_file !== false) {
 						ftruncate($local_file, 0);
 						fclose($local_file);
@@ -628,12 +628,12 @@ else
 	archive_add_table("adlist_by_group.json", "adlist_by_group");
 	archive_add_table("client_by_group.json", "client_by_group");
 
-	archive_add_file("/etc/pihole/","setupVars.conf");
-	archive_add_file("/etc/pihole/","dhcp.leases");
-	archive_add_file("/etc/pihole/","custom.list");
+	archive_add_file("/var/lib/pihole/","setupVars.conf");
+	archive_add_file("/var/lib/pihole/","dhcp.leases");
+	archive_add_file("/var/lib/pihole/","custom.list");
 	archive_add_file("/etc/pihole/","pihole-FTL.conf");
 	archive_add_file("/etc/","hosts","etc/");
-	archive_add_directory("/etc/dnsmasq.d/","dnsmasq.d/");
+	archive_add_directory("/etc/pihole/","dnsmasq.d/");
 
 	$archive->compress(Phar::GZ); // Creates a gzipped copy
 	unlink($archive_file_name); // Unlink original tar file as it is not needed anymore
diff --git a/scripts/pi-hole/php/update_checker.php b/scripts/pi-hole/php/update_checker.php
index d479318a..a58376e5 100644
--- a/scripts/pi-hole/php/update_checker.php
+++ b/scripts/pi-hole/php/update_checker.php
@@ -1,8 +1,8 @@
 <?php
 
-$localversions = "/etc/pihole/localversions";
-$localbranches = "/etc/pihole/localbranches";
-$GitHubVersions = "/etc/pihole/GitHubVersions";
+$localversions = "/var/lib/pihole/localversions";
+$localbranches = "/var/lib/pihole/localbranches";
+$GitHubVersions = "/var/lib/pihole/GitHubVersions";
 
 if(!is_readable($localversions) || !is_readable($localbranches) || !is_readable($GitHubVersions))
 {
-- 
2.35.1

