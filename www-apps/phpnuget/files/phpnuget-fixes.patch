diff --git a/inc/commons/mysqldb.php b/inc/commons/mysqldb.php
index 10b0d25..2f22d71 100644
--- a/inc/commons/mysqldb.php
+++ b/inc/commons/mysqldb.php
@@ -97,7 +97,7 @@ class MySqlDb
 			for($i=0;$i<sizeof($r);$i++){
 				$k = $r[$i];
 				$kt = $t[$i];
-				$val = $list[strtolower($k)];
+				$val = $list[$k];
 				if($kt=="object"){
 					$item->$k = unserialize($val);
 				}else if($kt=="number" && $val!=null){
diff --git a/inc/db_users.php b/inc/db_users.php
index dc46b01..896b392 100644
--- a/inc/db_users.php
+++ b/inc/db_users.php
@@ -14,7 +14,11 @@ require_once(__ROOT__."/inc/commons/objectsearch.php");
 require_once(__ROOT__."/inc/db_usersentity.php");
 
 
-define('__MYTXTDB_USR__',Path::Combine(Settings::$DataRoot,"nugetdb_usrs.txt"));
+if(__DB_TYPE__==DBMYSQL){
+	define('__MYTXTDB_USR__',"nugetdb_usrs");
+}else{
+	define('__MYTXTDB_USR__',Path::Combine(Settings::$DataRoot,"nugetdb_usrs.txt"));
+}
 define('__MYTXTDBROWS_USR__',
       "UserId:|:Name:|:Company:|:Md5Password:|:Packages:|:Enabled:|:Email:|:Token:|:Admin:|:Id");
 define('__MYTXTDBROWS_USR_TYP__',
@@ -89,7 +93,8 @@ class UserDb
 		
         if($doAdd){
             $toInsert["Token"]=Utils::NewGuid();
-			$toInsert["Id"]=Utils::NewGuid();
+						$toInsert["Id"]=Utils::NewGuid();
+						$toInsert["Md5Password"] = password_hash($toInsert["Password"], PASSWORD_DEFAULT);
             $dbInstance->add_row($toInsert);
         }else{
 			$dbInstance->update_row($toInsert,array("UserId"=>$toInsert["UserId"]));
diff --git a/inc/logincontroller.php b/inc/logincontroller.php
index 448f0ea..257f44f 100644
--- a/inc/logincontroller.php
+++ b/inc/logincontroller.php
@@ -13,6 +13,7 @@ class LoginController
 	{
 		session_start();
 		$doLogin = UrlUtils::GetRequestParamOrDefault("DoLogin","xxx","all");
+		$doRegister = UrlUtils::GetRequestParamOrDefault("DoRegister","xxx","all");
 		if("false"==$doLogin) {
 			session_unset();
 			session_destroy(); 
@@ -20,7 +21,20 @@ class LoginController
 			return;
 		}
 		
-		if("true"!=$doLogin && array_key_exists ("UserId",$_SESSION)){
+		if("true"==$doRegister) {
+			$udb = new UserDb();
+			try {
+				$udb->AddRow((object)$_POST, false);
+			} catch (Exception $e) {
+				$result = base64_encode($e->getMessage());
+				$location = UrlUtils::CurrentUrl(Settings::$SiteRoot."?specialType=logon&result=$result");
+				header("Location: ".$location);
+				die();
+			}
+			$location = UrlUtils::CurrentUrl(Settings::$SiteRoot."?specialType=logon");
+			header("Location: ".$location);
+			die();
+		}else if("true"!=$doLogin && array_key_exists ("UserId",$_SESSION)){
 			$this->IsLoggedIn = true;
 			$this->UserId = $_SESSION["UserId"];
 			$this->Admin = $_SESSION["Admin"];
@@ -84,7 +98,6 @@ class LoginController
 		}
 		
 		$uid = UrlUtils::GetRequestParam("UserId","post");
-		$pwd = md5(UrlUtils::GetRequestParam("Password","post"));
 		
 		$udb = new UserDb();
 		$user = null;
@@ -94,7 +107,7 @@ class LoginController
 			
 		if(sizeof($ar)==1){
 			$user = $ar[0];
-			if($user->Md5Password != $pwd) {
+			if (!password_verify(UrlUtils::GetRequestParam("Password","post"), $user->Md5Password)) {
 				$errorCode = -2;
 			} else if($user->Enabled != true) {
 				$errorCode = -3;
diff --git a/inc/partials/_logon.php b/inc/partials/_logon.php
index 34e945f..0b3e612 100644
--- a/inc/partials/_logon.php
+++ b/inc/partials/_logon.php
@@ -17,6 +17,7 @@
 				<div class="col-md-6" >
 					<h3>Register</h3>
 					<form class="form-horizontal" method="POST" action="<?php echo Settings::$SiteRoot;?>" >
+						<input type="hidden" id="DoRegister" name="DoRegister" value="true"/>
 						<div class="form-group">
 							<label class="control-label col-md-2" for="UserId">Username</label>
 							<div class="col-md-10">
